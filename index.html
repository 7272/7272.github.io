<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="./lib/js/angular.js"></script>
  <link rel="stylesheet" href="./css/base.css">
  <link rel="stylesheet" href="./css/index.css">
  <title>Document</title>
</head>


<body ng-app='one'>


  <section class="todoapp" ng-controller="two">
    <header class="header">
      <h1>todos</h1>
      <form ng-submit="doSubmit()">
        <input class="new-todo" placeholder="列出你要完成的事项" autofocus ng-keypress='mykeyup($event)' ng-model="listItem">
      </form>
    </header>
    <section class="main">
      <input class="toggle-all" type="checkbox">
      <ul class="todo-list">
        <li ng-repeat="item in data" ng-class="{completed:item.isFinish}">
          <div class="view">
            <input class="toggle" type="checkbox"  ng-click="toggle(item.id,$event)">
            <label>{{item.name}}</label>
            <button class="destroy" ng-click="remove(item)"></button>
          </div>
          <input class="edit" value="Rule the web">
        </li>
      </ul>
    </section>
    <footer class="footer">
      <span class="todo-count">还有<strong>{{count}}</strong>项未完成</span>
      <button class="clear-completed" ng-click="clear()">清除已完成</button>
    </footer>
  </section>

</body>

</html>
<script>
  angular.module('one', [])

    .controller('two', ['$scope', function ($scope) {
      $scope.data = []
      $scope.itemId = 0
      $scope.count =0;
      $scope.mykeyup = function (e) {
        $scope.itemId++
        if (e.keyCode == 13) {

          if ($scope.listItem != '' && $scope.listItem != undefined) {
            var obj = {
              name: $scope.listItem,
              id: $scope.itemId,
              isFinish: false
            }

            $scope.data.push(obj)
            $scope.listItem = ''
          $scope.count ++            
          }
        }
      }
      $scope.remove = function (item) {
        $scope.data.forEach((element, i) => {

          if (item.id == element.id) {
            if(element.isFinish == false){
              $scope.count--
            }
            $scope.data.splice(i, 1)
          }
        });
      }
      $scope.toggle = function (id,e) {        
        $scope.data.forEach((element, i) => {
          if (id == element.id) {
              if(e.target.checked){
                 $scope.count--
                  element.isFinish = true;
              }else{
                $scope.count++
                 element.isFinish = false;
              }

          }
        
        });
       }
      $scope.clear = function() {
        var arr =[]
           $scope.data.forEach((element, i) => {           

            if (element.isFinish == false) {
                arr.push(element)
            }
            $scope.data = arr
          });
        }
      }])
</script>